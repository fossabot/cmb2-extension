window.CMB2Ext=window.CMB2Ext||{},function(e,t,a,n,i,c){"use strict";e.cmb2_ext_l10;var s=e.setTimeout;n.$id=function(e){return a(t.getElementById(e))};var o={};n.init=function(){a(t),a.extend(n,o);var e=i.metabox(),c=e.find(".cmb-repeatable-group");n.makeListSortable(),n.initAjaxSearch(),n.initFontIcon(),a(".cmb-ext-tab-nav").on("click",".cmb-ext-tab-nav-menu",n.toggleTabNav),a(t).on("widget-updated widget-added",n.makeListSortable).on("widget-updated widget-added",n.initAjaxSearch),a(e).on("click",".cmb2-ext-buttonset-label",n.toggleButtonSelect).on("click",".cmb-ext-content-wrap-field-switch .button",n.initContentWrap).on("click",'ul.cmb-image-select-list li input[type="radio"]',n.triggerImageSelect).on("change.cmbAnimation",".cmb-type-animation select",n.animateOnChange).on("click",".cmb-ext-ajax-search-results a.remover",n.ajax_search_remove_listener).on("click.cmbAnimationPreview",".cmb-type-animation .cmb-ext-animation-preview-button",n.animateOnClick).on("click",".cmb-add-row-button",n.RepeatableFontIconDestroy),a(".cmb-repeat-table").on("click","cmb2_add_row",n.RepeatableFontIconRefresh),c.length&&c.on("cmb2_add_row",n.initAjaxSearchGroup).on("cmb2_add_group_row_start",n.FontIconAddGroupDestroy).on("cmb2_shift_rows_start",n.FontIconAddGroupShiftedDestroy).on("cmb2_shift_rows_complete",n.FontIconAddGroupShiftedRefresh).on("cmb2_add_row",n.FontIconAddGroupRefresh)},n.toggleTabNav=function(e){e.preventDefault();var t=a(this).parent(),n=t.data("panel"),i=t.parents(".cmb-tabs").find(".cmb-tabs-panel").find(".cmb-tab-panel-"+n);t.addClass("cmb-tab-active").siblings().removeClass("cmb-tab-active"),i.siblings().removeClass("show"),i.each(function(){a(this).addClass("show")})},n.initContentWrap=function(e){e.preventDefault();var t=a(this).closest(".cmb-ext-content-wrap");t.find("input").val(""),t.hasClass("cmb-ext-content-wrap-multiple")?(t.removeClass("cmb-ext-content-wrap-multiple").addClass("cmb-ext-content-wrap-single"),a(this).find("i").attr("class","dashicons dashicons-editor-expand")):(t.removeClass("cmb-ext-content-wrap-single").addClass("cmb-ext-content-wrap-multiple"),a(this).find("i").attr("class","dashicons dashicons-editor-contract"))},n.animateOnChange=function(e){var t=a(this).closest(".cmb-ext-animation").find(".cmb-ext-animation-preview-text");t.length&&(t.attr("class","cmb-ext-animation-preview-text animated"),t.addClass(a(this).val()))},n.animateOnClick=function(e){var t=a(this),n=t.next(".cmb-ext-animation-preview-text"),i=n.attr("class").replace("cmb-ext-animation-preview-text",""),c=t.prev("select").val();if(""===i&&""===c)return!1;""!==c&&(i=c+" animated"),n.attr("class","cmb-ext-animation-preview-text"),s(function(){n.addClass(i)},100)},n.makeListSortable=function(){var e=i.$metabox.find(".sortable-list-ext");e.length&&e.sortable({handle:"span",placeholder:"ui-state-highlight",forcePlaceholderSize:!0}).disableSelection()},n.triggerImageSelect=function(e){e.stopPropagation();var t=a(this).closest("ul");a(".cmb-image-select-selected",t).removeClass("cmb-image-select-selected"),a(this).parent().closest("li").addClass("cmb-image-select-selected")},n.toggleButtonSelect=function(){var e=a(this).parents(".cmb2-ext-buttonset");a(".cmb2-ext-buttonset-label",e).removeClass("selected"),a(this).addClass("selected")},n.initFontIcon=function(){a(".cmb-ext-iconselect").each(function(){a(this).fontIconPicker({theme:"fip-grey"})})},n.RepeatableFontIconDestroy=function(e){a(t.getElementById(a(e.target).data("selector"))).find(".cmb-row").last().find(".cmb-ext-iconselect").each(function(){a(this).fontIconPicker().destroyPicker()})},n.RepeatableFontIconRefresh=function(e,t){a(t).prev().find(".cmb-ext-iconselect").each(function(){a("option:selected",this).removeAttr("selected"),a(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},n.FontIconAddGroupDestroy=function(e,n){a(t.getElementById(a(n).data("selector"))).find(".cmb-repeatable-grouping").last().find(".cmb-ext-iconselect").each(function(){a(this).fontIconPicker().destroyPicker()})},n.FontIconAddGroupShiftedDestroy=function(e,t){a(t).closest(".cmb-repeatable-group").find(".cmb-ext-iconselect").each(function(){a(this).fontIconPicker().destroyPicker()})},n.FontIconAddGroupRefresh=function(e,t){a(t).find(".cmb-ext-iconselect").each(function(){a("option:selected",this).removeAttr("selected"),a(this).fontIconPicker().refreshPicker({theme:"fip-grey"})}),a(t).prev().find(".cmb-ext-iconselect").each(function(){a(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},n.FontIconAddGroupShiftedRefresh=function(e,t){a(t).closest(".cmb-repeatable-group").find(".cmb-ext-iconselect").each(function(){a(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},n.initAjaxSearch=function(){a('.cmb-ext-ajax-search:not([data-ajax-search="true"])').each(function(){a(this).attr("data-ajax-search",!0);a(this).attr("id");var e=a(this).attr("id").replace(new RegExp("_input$"),""),t=a(this).attr("data-object-type"),n=a(this).attr("data-query-args");a(this).devbridgeAutocomplete(Object.assign({serviceUrl:cmb2_ext_l10.ajaxurl,type:"POST",triggerSelectOnValidInput:!1,showNoSuggestionNotice:!0,params:{action:"cmb_ajax_search_get_results",nonce:cmb2_ext_l10.nonce,field_id:e,object_type:t,query_args:n},transformResult:function(t){var n=a.parseJSON(t);if(a("#"+e+"_results li").length){var i=[],c=0;a("#"+e+"_results input").each(function(e,t){i.push(a(this).val())}),a(n).each(function(e,t){a.inArray(t.id.toString(),i)>-1&&(n.splice(e-c,1),c++)})}return{suggestions:n}},onSearchStart:function(){a(this).next("img.cmb-ext-ajax-search-spinner").css("display","inline-block")},onSearchComplete:function(){a(this).next("img.cmb-ext-ajax-search-spinner").hide()},onSelect:function(e){a(this).devbridgeAutocomplete("clearCache");var t=a(this).attr("id").replace(new RegExp("_input$"),""),n=a(this).attr("data-multiple"),i=parseInt(a(this).attr("data-limit")),c=a(this).attr("data-sortable");1==n?(a("#"+t+"_results").append("<li>"+(1==c?'<span class="hndl"></span>':"")+'<input type="hidden" name="'+t+'[]" value="'+e.id+'"><a href="'+e.link+'" target="_blank" class="edit-link">'+e.value+'</a><a class="remover"><span class="dashicons dashicons-no"></span><span class="dashicons dashicons-dismiss"></span></a></li>'),a(this).val(""),i>0&&i==a("#"+t+"_results li").length?a(this).prop("disabled","disabled"):a(this).focus()):a("input[name="+t+"]").val(e.id).change()}},cmb2_ext_l10.options)),1==a(this).attr("data-sortable")&&a("#"+e+"_results").sortable({handle:".hndl",placeholder:"ui-state-highlight",forcePlaceholderSize:!0})})},n.initAjaxSearchGroup=function(e,t){t.find(".cmb-ext-ajax-search").attr("data-ajax-search",!1),n.initAjaxSearch()},n.ajax_search_remove_listener=function(){a(this).parent("li").fadeOut(400,function(){var e=a(this).parents("ul").attr("id").replace("_results","");a("#"+e).removeProp("disabled"),a("#"+e).devbridgeAutocomplete("clearCache"),a(this).remove()})},a(n.init)}(window,document,jQuery,window.CMB2Ext,window.CMB2);