window.CMB2Ext=window.CMB2Ext||{},function(e,t,n,a,i,c){"use strict";e.cmb2_ext_l10;var o=e.setTimeout;a.$id=function(e){return n(t.getElementById(e))};var s={};a.init=function(){n(t),n.extend(a,s);var e=i.metabox(),c=e.find(".cmb-repeatable-group");a.makeListSortable(),a.initAjaxSearch(),a.initFont(),a.initIcon(),n(".cmb-ext-tab-nav").on("click",".cmb-ext-tab-nav-menu",a.toggleTabNav),n(t).on("widget-updated widget-added",a.makeListSortable).on("widget-updated widget-added",a.initAjaxSearch),n(e).on("click",".cmb2-ext-buttonset-label",a.toggleButtonSelect).on("click",".cmb-ext-content-wrap-field-switch .button",a.initContentWrap).on("click",'ul.cmb-image-select-list li input[type="radio"]',a.triggerImageSelect).on("change.cmbAnimation",".cmb-type-animation select",a.animateOnChange).on("click",".cmb-ext-ajax-search-results a.remover",a.ajax_search_remove_listener).on("click.cmbAnimationPreview",".cmb-type-animation .cmb-ext-animation-preview-button",a.animateOnClick).on("click",".cmb-add-row-button",a.RepeatableFontIconDestroy),n(".cmb-repeat-table").on("click","cmb2_add_row",a.RepeatableFontIconRefresh),c.length&&c.on("cmb2_add_row",a.initAjaxSearchGroup).on("cmb2_add_group_row_start",a.FontIconAddGroupDestroy).on("cmb2_shift_rows_start",a.FontIconAddGroupShiftedDestroy).on("cmb2_shift_rows_complete",a.FontIconAddGroupShiftedRefresh).on("cmb2_add_row",a.FontIconAddGroupRefresh)},a.toggleTabNav=function(e){e.preventDefault();var t=n(this).parent(),a=t.data("panel"),i=t.parents(".cmb-tabs").find(".cmb-tabs-panel").find(".cmb-tab-panel-"+a);t.addClass("cmb-tab-active").siblings().removeClass("cmb-tab-active"),i.siblings().removeClass("show"),i.each(function(){n(this).addClass("show")})},a.initContentWrap=function(e){e.preventDefault();var t=n(this).closest(".cmb-ext-content-wrap");t.find("input").val(""),t.hasClass("cmb-ext-content-wrap-multiple")?(t.removeClass("cmb-ext-content-wrap-multiple").addClass("cmb-ext-content-wrap-single"),n(this).find("i").attr("class","dashicons dashicons-editor-expand")):(t.removeClass("cmb-ext-content-wrap-single").addClass("cmb-ext-content-wrap-multiple"),n(this).find("i").attr("class","dashicons dashicons-editor-contract"))},a.animateOnChange=function(e){var t=n(this).closest(".cmb-ext-animation").find(".cmb-ext-animation-preview-text");t.length&&(t.attr("class","cmb-ext-animation-preview-text animated"),t.addClass(n(this).val()))},a.animateOnClick=function(e){var t=n(this),a=t.next(".cmb-ext-animation-preview-text"),i=a.attr("class").replace("cmb-ext-animation-preview-text",""),c=t.prev("select").val();if(""===i&&""===c)return!1;""!==c&&(i=c+" animated"),a.attr("class","cmb-ext-animation-preview-text"),o(function(){a.addClass(i)},100)},a.makeListSortable=function(){var e=i.$metabox.find(".sortable-list-ext");e.length&&e.sortable({handle:"span",placeholder:"ui-state-highlight",forcePlaceholderSize:!0}).disableSelection()},a.triggerImageSelect=function(e){e.stopPropagation();var t=n(this).closest("ul");n(".cmb-image-select-selected",t).removeClass("cmb-image-select-selected"),n(this).parent().closest("li").addClass("cmb-image-select-selected")},a.toggleButtonSelect=function(){var e=n(this).parents(".cmb2-ext-buttonset");n(".cmb2-ext-buttonset-label",e).removeClass("selected"),n(this).addClass("selected")},a.initFont=function(){n(".cmb-type-font select").each(function(){n(this).higooglefonts({theme:"default cmb-ext-font-select2",selectedCallback:function(e){console.log(e)},loadedCallback:function(e){console.log(e),n("#paragraph").css("font-family",e)}})})},a.initIcon=function(){n(".cmb-ext-iconselect").each(function(){n(this).fontIconPicker({theme:"fip-grey"})})},a.RepeatableFontIconDestroy=function(e){n(t.getElementById(n(e.target).data("selector"))).find(".cmb-row").last().find(".cmb-ext-iconselect").each(function(){n(this).fontIconPicker().destroyPicker()})},a.RepeatableFontIconRefresh=function(e,t){n(t).prev().find(".cmb-ext-iconselect").each(function(){n("option:selected",this).removeAttr("selected"),n(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},a.FontIconAddGroupDestroy=function(e,a){n(t.getElementById(n(a).data("selector"))).find(".cmb-repeatable-grouping").last().find(".cmb-ext-iconselect").each(function(){n(this).fontIconPicker().destroyPicker()})},a.FontIconAddGroupShiftedDestroy=function(e,t){n(t).closest(".cmb-repeatable-group").find(".cmb-ext-iconselect").each(function(){n(this).fontIconPicker().destroyPicker()})},a.FontIconAddGroupRefresh=function(e,t){n(t).find(".cmb-ext-iconselect").each(function(){n("option:selected",this).removeAttr("selected"),n(this).fontIconPicker().refreshPicker({theme:"fip-grey"})}),n(t).prev().find(".cmb-ext-iconselect").each(function(){n(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},a.FontIconAddGroupShiftedRefresh=function(e,t){n(t).closest(".cmb-repeatable-group").find(".cmb-ext-iconselect").each(function(){n(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})},a.initAjaxSearch=function(){n('.cmb-ext-ajax-search:not([data-ajax-search="true"])').each(function(){n(this).attr("data-ajax-search",!0);n(this).attr("id");var e=n(this).attr("id").replace(new RegExp("_input$"),""),t=n(this).attr("data-object-type"),a=n(this).attr("data-query-args");n(this).devbridgeAutocomplete(Object.assign({serviceUrl:cmb2_ext_l10.ajaxurl,type:"POST",triggerSelectOnValidInput:!1,showNoSuggestionNotice:!0,params:{action:"cmb_ajax_search_get_results",nonce:cmb2_ext_l10.nonce,field_id:e,object_type:t,query_args:a},transformResult:function(t){var a=n.parseJSON(t);if(n("#"+e+"_results li").length){var i=[],c=0;n("#"+e+"_results input").each(function(e,t){i.push(n(this).val())}),n(a).each(function(e,t){n.inArray(t.id.toString(),i)>-1&&(a.splice(e-c,1),c++)})}return{suggestions:a}},onSearchStart:function(){n(this).next("img.cmb-ext-ajax-search-spinner").css("display","inline-block")},onSearchComplete:function(){n(this).next("img.cmb-ext-ajax-search-spinner").hide()},onSelect:function(e){n(this).devbridgeAutocomplete("clearCache");var t=n(this).attr("id").replace(new RegExp("_input$"),""),a=n(this).attr("data-multiple"),i=parseInt(n(this).attr("data-limit")),c=n(this).attr("data-sortable");1==a?(n("#"+t+"_results").append("<li>"+(1==c?'<span class="hndl"></span>':"")+'<input type="hidden" name="'+t+'[]" value="'+e.id+'"><a href="'+e.link+'" target="_blank" class="edit-link">'+e.value+'</a><a class="remover"><span class="dashicons dashicons-no"></span><span class="dashicons dashicons-dismiss"></span></a></li>'),n(this).val(""),i>0&&i==n("#"+t+"_results li").length?n(this).prop("disabled","disabled"):n(this).focus()):n("input[name="+t+"]").val(e.id).change()}},cmb2_ext_l10.options)),1==n(this).attr("data-sortable")&&n("#"+e+"_results").sortable({handle:".hndl",placeholder:"ui-state-highlight",forcePlaceholderSize:!0})})},a.initAjaxSearchGroup=function(e,t){t.find(".cmb-ext-ajax-search").attr("data-ajax-search",!1),a.initAjaxSearch()},a.ajax_search_remove_listener=function(){n(this).parent("li").fadeOut(400,function(){var e=n(this).parents("ul").attr("id").replace("_results","");n("#"+e).removeProp("disabled"),n("#"+e).devbridgeAutocomplete("clearCache"),n(this).remove()})},n(a.init)}(window,document,jQuery,window.CMB2Ext,window.CMB2);