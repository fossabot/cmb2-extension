window.CMB2Ext=window.CMB2Ext||{},function(e,a,c,t,n){"use strict";e.cmb2_ext_l10;var s=e.setTimeout;t.$id=function(e){return c(a.getElementById(e))};var i={};function o(){c('.cmb-ext-ajax-search:not([data-ajax-search="true"])').each(function(){c(this).attr("data-ajax-search",!0);c(this).attr("id");var t=c(this).attr("id").replace(new RegExp("_input$"),""),e=c(this).attr("data-object-type"),a=c(this).attr("data-query-args");c(this).devbridgeAutocomplete(Object.assign({serviceUrl:cmb2_ext_l10.ajaxurl,type:"POST",triggerSelectOnValidInput:!1,showNoSuggestionNotice:!0,params:{action:"cmb_ajax_search_get_results",nonce:cmb2_ext_l10.nonce,field_id:t,object_type:e,query_args:a},transformResult:function(e){var a=c.parseJSON(e);if(c("#"+t+"_results li").length){var n=[],i=0;c("#"+t+"_results input").each(function(e,t){n.push(c(this).val())}),c(a).each(function(e,t){-1<c.inArray(t.id.toString(),n)&&(a.splice(e-i,1),i++)})}return{suggestions:a}},onSearchStart:function(){c(this).next("img.cmb-ext-ajax-search-spinner").css("display","inline-block")},onSearchComplete:function(){c(this).next("img.cmb-ext-ajax-search-spinner").hide()},onSelect:function(e){c(this).devbridgeAutocomplete("clearCache");var t=c(this).attr("id").replace(new RegExp("_input$"),""),a=c(this).attr("data-multiple"),n=parseInt(c(this).attr("data-limit")),i=c(this).attr("data-sortable");1==a?(c("#"+t+"_results").append("<li>"+(1==i?'<span class="hndl"></span>':"")+'<input type="hidden" name="'+t+'[]" value="'+e.id+'"><a href="'+e.link+'" target="_blank" class="edit-link">'+e.value+'</a><a class="remover"><span class="dashicons dashicons-no"></span><span class="dashicons dashicons-dismiss"></span></a></li>'),c(this).val(""),0<n&&n==c("#"+t+"_results li").length?c(this).prop("disabled","disabled"):c(this).focus()):c("input[name="+t+"]").val(e.id).change()}},cmb2_ext_l10.options)),1==c(this).attr("data-sortable")&&c("#"+t+"_results").sortable({handle:".hndl",placeholder:"ui-state-highlight",forcePlaceholderSize:!0})})}t.init=function(){c(a),c.extend(t,i);var e=n.metabox();e.find(".cmb-repeatable-group");t.makeListSortable(),c(".cmb-ext-tab-nav").on("click",".cmb-ext-tab-nav-menu",t.toggleTabNav),c(a).on("widget-updated widget-added",t.makeListSortable),c(e).on("click",".cmb2-ext-buttonset-label",t.toggleButtonSelect).on("click",".cmb-ext-content-wrap-field-switch .button",t.initContentWrap).on("click",'ul.cmb-image-select-list li input[type="radio"]',t.triggerImageSelect).on("change.cmbAnimation",".cmb-type-animation select",t.animateOnChange).on("click.cmbAnimationPreview",".cmb-type-animation .cmb-ext-animation-preview-button",t.animateOnClick)},t.toggleTabNav=function(e){e.preventDefault();var t=c(this).parent(),a=t.data("panel"),n=t.parents(".cmb-tabs").find(".cmb-tabs-panel").find(".cmb-tab-panel-"+a);t.addClass("cmb-tab-active").siblings().removeClass("cmb-tab-active"),n.siblings().removeClass("show"),n.each(function(){c(this).addClass("show")})},t.initContentWrap=function(e){e.preventDefault();var t=c(this).closest(".cmb-ext-content-wrap");t.find("input").val(""),t.hasClass("cmb-ext-content-wrap-multiple")?(t.removeClass("cmb-ext-content-wrap-multiple").addClass("cmb-ext-content-wrap-single"),c(this).find("i").attr("class","dashicons dashicons-editor-expand")):(t.removeClass("cmb-ext-content-wrap-single").addClass("cmb-ext-content-wrap-multiple"),c(this).find("i").attr("class","dashicons dashicons-editor-contract"))},t.animateOnChange=function(e){var t=c(this).next(".cmb-ext-animation-preview-text");0<t.length&&(t.attr("class","cmb-ext-animation-preview-text animated"),t.addClass(c(this).val()))},t.animateOnClick=function(e){var t=c(this),a=t.next(".cmb-ext-animation-preview-text"),n=a.attr("class").replace("cmb-ext-animation-preview-text",""),i=t.prev("select").val();if(""===n&&""===i)return!1;""!==i&&(n=i+" animated"),a.attr("class","cmb-ext-animation-preview-text"),s(function(){a.addClass(n)},100)},t.makeListSortable=function(){var e=n.metabox().find(".sortable-list-ext");e.length&&e.sortable({handle:"span",placeholder:"ui-state-highlight",forcePlaceholderSize:!0}).disableSelection()},t.triggerImageSelect=function(e){e.stopPropagation(),c(this).closest("ul").find(".cmb-image-select-selected").removeClass("cmb-image-select-selected"),c(this).parent().closest("li").addClass("cmb-image-select-selected")},t.toggleButtonSelect=function(){var e=c(this).parents(".cmb2-ext-buttonset");c(".cmb2-ext-buttonset-label",e).removeClass("selected"),c(this).addClass("selected")},c(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker({theme:"fip-grey"})}),c(".cmb-repeatable-group").on("cmb2_add_group_row_start",function(e,t){c(a.getElementById(c(t).data("selector"))).find(".cmb-repeatable-grouping").last().find(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker().destroyPicker()})}),c(".cmb-repeatable-group").on("cmb2_add_row",function(e,t){c(t).find(".cmb-ext-iconselect").each(function(){c("option:selected",this).removeAttr("selected"),c(this).fontIconPicker().refreshPicker({theme:"fip-grey"})}),c(t).prev().find(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})}),c(".cmb-repeatable-group").on("cmb2_shift_rows_start",function(e,t){c(t).closest(".cmb-repeatable-group").find(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker().destroyPicker()})}),c(".cmb-repeatable-group").on("cmb2_shift_rows_complete",function(e,t){c(t).closest(".cmb-repeatable-group").find(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})}),c(".cmb-add-row-button").on("click",function(e){c(a.getElementById(c(e.target).data("selector"))).find(".cmb-row").last().find(".cmb-ext-iconselect").each(function(){c(this).fontIconPicker().destroyPicker()})}),c(".cmb-repeat-table").on("cmb2_add_row",function(e,t){c(t).prev().find(".cmb-ext-iconselect").each(function(){c("option:selected",this).removeAttr("selected"),c(this).fontIconPicker().refreshPicker({theme:"fip-grey"})})}),o(),c(a).on("cmb2_add_row",function(e,t){t.find(".cmb-ext-ajax-search").attr("data-ajax-search",!1),o()}),c(a).on("widget-updated widget-added",function(){o()}),c("body").on("click",".cmb-ext-ajax-search-results a.remover",function(){c(this).parent("li").fadeOut(400,function(){var e=c(this).parents("ul").attr("id").replace("_results","");c("#"+e).removeProp("disabled"),c("#"+e).devbridgeAutocomplete("clearCache"),c(this).remove()})}),c(t.init)}(window,document,jQuery,window.CMB2Ext,window.CMB2);